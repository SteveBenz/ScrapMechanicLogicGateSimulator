(this.webpackJsonplogicgate=this.webpackJsonplogicgate||[]).push([[0],{100:function(t,e,i){"use strict";i.r(e);i(47);var n=i(0),a=i(13),s=i(6),r=i(7),o=i(17),c=i(9),l=i(8),u=i(15),h=i.n(u),d=i(45),p=i(2),f=i(33),v=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).textRef=void 0,n.lastWidthUsed=void 0,n._handleTick=function(){n.textRef&&(n.textRef.text(n.props.simulator.currentTick.toString()),n.lastWidthUsed=n.textRef.width(),n.textRef.x(n.props.right-n.textRef.width()))},n.state={currentTick:t.simulator.currentTick},n.lastWidthUsed=20,n}return Object(r.a)(i,[{key:"componentDidMount",value:function(){this.props.simulator.onTick(this._handleTick),this._handleTick()}},{key:"componentWillUnmount",value:function(){this.props.simulator.offTick(this._handleTick)}},{key:"render",value:function(){var t=this;return Object(n.jsx)(p.Text,{y:this.props.top,x:this.props.right-this.lastWidthUsed,ref:function(e){t.textRef=e},fill:"red",fontSize:30})}}]),i}(u.Component),b=i(16),k=i(14),g=i(32),y=i.n(g),m=i(11),j={},O=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(){var t;Object(s.a)(this,i);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))).attachedModel=void 0,t.group=void 0,t.handleStateChanged=function(){t.setState({})},t}return Object(r.a)(i,[{key:"componentDidMount",value:function(){this.attachedModel||(this.attachedModel=this.props.model,this.attachedModel.onStateChanged(this.handleStateChanged))}},{key:"componentWillUnmount",value:function(){console.debug("componentDidUnmount("+this.constructor.name+")"),this.attachedModel&&(this.attachedModel.offStateChanged(this.handleStateChanged),this.attachedModel=void 0)}},{key:"handleOnClick",value:function(t){this.props.onClick&&this.props.onClick({evt:t.evt,model:this.props.model})}},{key:"handleDragStart",value:function(t){if(!t.evt.shiftKey){if(!this.group)throw new Error("group did not get set in render");this.group.stopDrag(),this.props.onLinkStart&&this.props.onLinkStart({evt:t.evt,model:this.props.model})}}},{key:"handleOnMouseUp",value:function(t){this.props.onMouseUp&&this.props.onMouseUp({evt:t.evt,model:this.props.model})}},{key:"handleDragEnd",value:function(){}},{key:"handleDragMove",value:function(t){var e=t.target.absolutePosition();this.props.model.setPosition(e.x,e.y)}},{key:"render",value:function(){var t=this;return this.props.model!==this.attachedModel&&void 0!==this.attachedModel&&(this.attachedModel.offStateChanged(this.handleStateChanged),this.attachedModel=this.props.model,this.attachedModel.onStateChanged(this.handleStateChanged)),Object(n.jsx)(p.Group,{onClick:this.handleOnClick.bind(this),vonMouseUp:this.handleOnMouseUp.bind(this),ref:function(e){return t.group=e},draggable:!0,x:this.props.model.x,y:this.props.model.y,onDragStart:this.handleDragStart.bind(this),onDragMove:this.handleDragMove.bind(this),onDragEnd:this.handleDragEnd.bind(this),children:this.groupContent()})}},{key:"groupContent",value:function(){return[Object(n.jsx)(p.Rect,{height:64,width:64,strokeWidth:3,stroke:this.props.isSelected?"green":"blue",fill:this.props.model.currentState?"white":"grey"},"surround")]}}]),i}(h.a.Component),x=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(){return Object(s.a)(this,i),e.apply(this,arguments)}return Object(r.a)(i,[{key:"groupContent",value:function(){if(this.props.model instanceof m.c){return Object(b.a)(Object(k.a)(i.prototype),"groupContent",this).call(this).concat(Object(n.jsx)(p.Line,{points:[47,0,63,0,63,16],fill:this.props.model.savedState?"blue":"transparent",stroke:"blue",strokeWidth:3,closed:!0},"saveStateIndicator"))}return Object(b.a)(Object(k.a)(i.prototype),"groupContent",this).call(this)}}]),i}(O),S=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),n=e.call(this,t),console.debug("constructor(LogicGate)"),n}return Object(r.a)(i,[{key:"groupContent",value:function(){return Object(b.a)(Object(k.a)(i.prototype),"groupContent",this).call(this).concat([Object(n.jsx)(p.Image,{x:0,y:0,image:j[this.props.model.kind].image()},"image")])}}]),i}(x),_=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),n=e.call(this,t),console.debug("constructor(Input)"),n}return Object(r.a)(i,[{key:"groupContent",value:function(){return Object(b.a)(Object(k.a)(i.prototype),"groupContent",this).call(this).concat([Object(n.jsx)(p.Circle,{radius:22,x:32,y:32,strokeWidth:8,stroke:"black"},"image")])}}]),i}(x),w=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),n=e.call(this,t),console.debug("constructor(Timer)"),n}return Object(r.a)(i,[{key:"groupContent",value:function(){var t=this,e=52/this.props.model.tickStorage.length;return Object(b.a)(Object(k.a)(i.prototype),"groupContent",this).call(this).concat(this.props.model.tickStorage.map((function(i,a){return Object(n.jsx)(p.Rect,{x:12,width:40,y:58-e-52*a/t.props.model.tickStorage.length,height:e,strokeWidth:1,stroke:"darkgrey",fill:i?"blue":"white"},"image")})))}}]),i}(O),T=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).attachedModel=void 0,n._handleStateChanged=function(){n.setState({})},n.state={},n}return Object(r.a)(i,[{key:"componentDidMount",value:function(){this.attachedModel||(this.attachedModel=this.props.source,this.attachedModel.onStateChanged(this._handleStateChanged))}},{key:"componentWillUnmount",value:function(){this.props.source.offStateChanged(this._handleStateChanged),this.attachedModel=void 0}},{key:"render",value:function(){this.props.source!==this.attachedModel&&void 0!==this.attachedModel&&(this.attachedModel.offStateChanged(this._handleStateChanged),this.attachedModel=this.props.source,this.attachedModel.onStateChanged(this._handleStateChanged));var t=this.props.source.x+32,e=this.props.source.y+32,i=this.props.target.x+32,a=this.props.target.y+32;if(Math.abs(a-e)<Math.abs(i-t)){var s=i>t?1:-1,r=32*(a-e)/(i-t);t+=32*s,i-=32*s,e+=s*r,a-=s*r}else{var o=a>e?1:-1,c=32*(i-t)/(a-e);t+=o*c,i-=o*c,e+=32*o,a-=32*o}return Object(n.jsx)(p.Arrow,{x:t,y:e,points:[0,0,i-t,a-e],fill:this.props.source.prevState?"darkblue":"teal",stroke:this.props.source.prevState?"darkblue":"teal",strokeWidth:4,pointerLength:10,pointerWidth:10})}}]),i}(h.a.Component);var I=i(46),C=i.n(I),M=1.05,R=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).timeoutHandle=void 0,n.handleDragStart=void 0,n.toolTipId=void 0,n._handleTimeout=function(){if(n.timeoutHandle=void 0,n.toolTipId){var t=document.getElementById(n.toolTipId);if(!t)throw new Error("toolTipId is defined, but not in the docuemnt");t.style.visibility="visible",t.style.top=n.props.y-t.clientHeight-5+"px";var e=n.props.x+32-t.clientWidth/2;e<0&&(e=10),t.style.top=n.props.y-t.clientHeight-5+"px",t.style.left=e+"px"}},n._handleMouseEnter=function(){n.setState({isHovering:!0}),n.startToolTipTimer()},n._handleMouseLeave=function(t){n.handleDragStart&&n.state.isPressed&&t.evt.offsetY<n.props.y+32&&n.handleDragStart(t),n.setState({isHovering:!1,isPressed:!1}),n.clearToolTipTimer()},n._handleMouseDown=function(){n.setState({isPressed:!0}),n.clearToolTipTimer()},n._handleMouseUp=function(){n.setState({isPressed:!1}),n.handleClick(),n.startToolTipTimer()},n}return Object(r.a)(i,[{key:"render",value:function(){return Object(n.jsxs)(p.Group,{x:this.props.x-(this.state.isPressed?1.6000000000000014:0),y:this.props.y-(this.state.isPressed?1.6000000000000014:0),onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave,onMouseDown:this._handleMouseDown,onMouseUp:this._handleMouseUp,scaleX:this.state.isPressed?M:1,scaleY:this.state.isPressed?M:1,children:[this.getContent(),Object(n.jsx)(p.Rect,{x:0,y:0,height:64,width:64,strokeWidth:2,stroke:this.state.isHovering?"black":"grey",fill:this.state.isEnabled?"transparent":"#80808080"})]})}},{key:"componentWillUnmount",value:function(){this.clearToolTipTimer()}},{key:"startToolTipTimer",value:function(){!this.timeoutHandle&&this.toolTipId&&document.getElementById(this.toolTipId)&&(this.timeoutHandle=setTimeout(this._handleTimeout,1e3))}},{key:"clearToolTipTimer",value:function(){if(this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0),this.toolTipId){var t=document.getElementById(this.toolTipId);if(!t)throw new Error("toolTipId is defined, but not in the docuemnt");t.style.visibility="hidden"}}}]),i}(u.Component),D=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="playPauseTip",n.state={isHovering:!1,isEnabled:!0,isPressed:!1,isRunning:n.props.model.isRunning},n.props.model.onRunStateChanged(n.handleRunStateChanged.bind(Object(o.a)(n))),n}return Object(r.a)(i,[{key:"handleRunStateChanged",value:function(){this.setState({isRunning:this.props.model.isRunning})}},{key:"getContent",value:function(){return this.props.model.isRunning?[Object(n.jsx)(p.Line,{points:[27,20,27,44],lineCap:"butt",strokeWidth:5,stroke:"red"},"1"),Object(n.jsx)(p.Line,{points:[37,20,37,44],lineCap:"butt",strokeWidth:5,stroke:"red"},"2")]:[Object(n.jsx)(p.Line,{points:[16,16,44,32,16,48],strokeWidth:4,stroke:"green",fill:"green",closed:!0},"3")]}},{key:"handleClick",value:function(){this.props.model.isRunning?this.props.model.stopRunning():this.props.model.startRunning()}}]),i}(R),E=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="singleStepTip",n.state={isHovering:!1,isEnabled:!0,isPressed:!1},n.props.model.onRunStateChanged((function(){return n.setState({isEnabled:!n.props.model.isRunning})})),n}return Object(r.a)(i,[{key:"getContent",value:function(){return Object(n.jsx)(p.Line,{points:[44,32,16,48,16,16,44,32,44,16,44,48],strokeWidth:4,stroke:this.state.isEnabled?"#008000ff":"#305030ff",closed:!1})}},{key:"handleClick",value:function(){this.props.model.advanceOne()}}]),i}(R),L=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="input"===n.props.kind?"inputTip":"timer"===n.props.kind?"timerTip":"logicGateTip",n.handleDragStart=function(t){var e;switch(n.props.kind){case"timer":e=new m.e({x:t.evt.offsetX,y:t.evt.offsetY,kind:n.props.kind,tickStorage:new Array(10).fill(!1)});break;case"input":e=new m.a({x:t.evt.offsetX,y:t.evt.offsetY,savedState:!1,kind:n.props.kind});break;default:e=new m.d({x:t.evt.offsetX,y:t.evt.offsetY,savedState:!1,kind:n.props.kind})}n.props.onBeginDrag({prototype:e,event:t})},n.state={isEnabled:!0,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){switch(this.props.kind){case"input":return Object(n.jsx)(p.Circle,{radius:22,x:32,y:32,strokeWidth:8,stroke:this.state.isEnabled?"black":"#00000080"});case"timer":var t=[!0,!0,!0,!0,!0,!1,!1,!1,!1,!1],e=52/t.length;return t.map((function(i,a){return Object(n.jsx)(p.Rect,{x:12,width:40,y:58-e-52*a/t.length,height:e,strokeWidth:1,stroke:"darkgrey",fill:i?"blue":"white"},a)}));default:return Object(n.jsx)(p.Image,{x:0,y:0,image:j[this.props.kind].image()})}}},{key:"handleClick",value:function(){this.props.selected&&("input"===this.props.kind&&this.props.selected instanceof m.a?this.props.selected.twiddle(1):"timer"===this.props.kind&&this.props.selected instanceof m.e||"timer"!==this.props.kind&&"input"!==this.props.kind&&this.props.selected instanceof m.d&&(this.props.selected.kind=this.props.kind))}}]),i}(R),P=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="paintTip",n.state={isEnabled:!0,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){return Object(n.jsx)(p.Image,{x:0,y:0,image:j.paint.image()})}},{key:"handleClick",value:function(){this.props.selected instanceof m.c&&this.props.selected.paint()}}]),i}(R),W=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="putOnLiftTip",n.state={isEnabled:!0,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){return[Object(n.jsx)(p.Line,{points:[52,48,12,48,12,28,32,28,32,12,16,12,48,12,32,12,32,28,52,28,52,48],strokeWidth:4,stroke:"black",closed:!0},"base"),Object(n.jsx)(p.Line,{points:[18,42,32,32,46,42,18,42],strokeWidth:1,stroke:"blue",closed:!0,fill:"blue"},"arrow")]}},{key:"handleClick",value:function(){var t,e=Object(a.a)(this.props.simulator.interactables);try{for(e.s();!(t=e.n()).done;){t.value.reload()}}catch(i){e.e(i)}finally{e.f()}}}]),i}(R),U=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="takeOffLiftTip",n.state={isEnabled:!0,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){return[Object(n.jsx)(p.Line,{points:[52,48,12,48,12,28,32,28,32,12,16,12,48,12,32,12,32,28,52,28,52,48],strokeWidth:4,stroke:"black",closed:!0},"base"),Object(n.jsx)(p.Line,{points:[18,32,32,42,46,32,18,32],strokeWidth:1,stroke:"blue",closed:!0,fill:"blue"},"arrow")]}},{key:"handleClick",value:function(){var t,e=Object(a.a)(this.props.simulator.interactables);try{for(e.s();!(t=e.n()).done;){t.value.paint()}}catch(i){e.e(i)}finally{e.f()}}}]),i}(R),B=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="deleteTip",n.state={isEnabled:void 0!==n.props.selected,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){return Object(n.jsx)(p.Text,{text:"\ud83d\uddd1",x:10,y:8,fontSize:64,fill:"black"})}},{key:"handleClick",value:function(){this.props.selected&&this.props.simulator.remove(this.props.selected)}}],[{key:"getDerivedStateFromProps",value:function(t,e){return{isEnabled:void 0!==t.selected,isHovering:e.isHovering,isPressed:e.isPressed}}}]),i}(R),H=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="shareLinkTip",n.state={isEnabled:!0,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){return Object(n.jsx)(p.Text,{text:"\ud83d\udd17",x:6,y:14,fontSize:42,fill:"black"})}},{key:"handleClick",value:function(){var t=document.createElement("textarea");if(!t)throw new Error("textarea is missing in index.html");t.style.top="0",t.style.left="0",t.style.position="fixed",t.value=window.location.origin+window.location.pathname+"?"+this.props.simulator.serializeToCompressedQueryStringFragment(),t.focus(),t.select();try{var e=document.execCommand("copy");alert("Fallback: Copying text command was "+(e?"successful":"unsuccessful"))}catch(i){console.error("Fallback: Oops, unable to copy",i)}}}]),i}(R),A=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="saveTip",n.state={isEnabled:!0,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){return Object(n.jsx)(p.Text,{text:"\ud83d\udcbe",x:6,y:14,fontSize:42,fill:"black"})}},{key:"handleClick",value:function(){var t=new File([JSON.stringify(this.props.simulator.serialize(),null,4)],"logicgatesim.json",{type:"text/plain;charset=utf-8"});C.a.saveAs(t)}}]),i}(R),F=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;Object(s.a)(this,i),(n=e.call(this,t)).fileInputElement=void 0,n.toolTipId="loadTip",n.state={isEnabled:!0,isHovering:!1,isPressed:!1};var a=document.getElementById("fileElem");if(!a)throw new Error("index.html is busted - fileElem <input> is missing");return n.fileInputElement=a,n.fileInputElement.addEventListener("change",n.handleFileGiven.bind(Object(o.a)(n)),!1),n}return Object(r.a)(i,[{key:"getContent",value:function(){return Object(n.jsx)(p.Text,{text:"\ud83d\udcc1",x:6,y:14,fontSize:42,fill:"black"})}},{key:"handleClick",value:function(){var t=document.getElementById("fileElem");if(!t)throw new Error("fileElem is missing in index.html");t.click()}},{key:"handleFileGiven",value:function(){var t=this;if(this.fileInputElement.files&&0!==this.fileInputElement.files.length){var e=new FileReader;e.onload=function(){var i=e.result,n=JSON.parse(i);t.props.simulator.load(n)},e.readAsText(this.fileInputElement.files[0])}}}]),i}(R),z=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,t)).toolTipId="reloadTip",n.state={isEnabled:!0,isHovering:!1,isPressed:!1},n}return Object(r.a)(i,[{key:"getContent",value:function(){return Object(n.jsx)(p.Text,{text:"\u21c5",x:16,y:14,fontSize:42,fill:"black"})}},{key:"handleClick",value:function(){this.props.simulator.gameReload()}}]),i}(R),N=function(t){Object(c.a)(i,t);var e=Object(l.a)(i);function i(t){var n;Object(s.a)(this,i),(n=e.call(this,t)).stage=void 0,n.maxSensibleDropY=0,n.handleInteractablesReset=function(t){var e,i=Object(a.a)(t.oldInteractables);try{for(i.s();!(e=i.n()).done;){e.value.offMoved(n.handleInteractableMoved)}}catch(d){i.e(d)}finally{i.f()}var s,r=[],o=Object(a.a)(n.props.simulator.interactables);try{for(o.s();!(s=o.n()).done;){var c=s.value;c.onMoved(n.handleInteractableMoved);var l,u=Object(a.a)(c.inputs);try{for(u.s();!(l=u.n()).done;){var h=l.value;r.push({source:h,target:c})}}catch(d){u.e(d)}finally{u.f()}}}catch(d){o.e(d)}finally{o.f()}n.setState({interactables:n.props.simulator.interactables,selected:void 0,links:r})},n.handleInteractableAdded=function(t){t.interactable.onMoved(n.handleInteractableMoved.bind(Object(o.a)(n))),n.setState({interactables:n.props.simulator.interactables,selected:t.interactable})},n.handleInteractableRemoved=function(t){t.interactable.offMoved(n.handleInteractableMoved.bind(Object(o.a)(n))),n.setState({interactables:n.props.simulator.interactables,selected:void 0,links:n.state.links.filter((function(e){return e.target!==t.interactable&&e.source!==t.interactable}))})},n.handleInteractableMoved=function(){n.setState({interactables:n.props.simulator.interactables})},n.handleResize=function(){n.setState({windowInnerWidth:window.innerWidth,windowInnerHeight:window.innerHeight})},n.handleKeyPress=function(t){var e,i=null===(e=n.stage)||void 0===e?void 0:e.getPointerPosition();if(!i)throw new Error("stage was not set?");if("g"===t.key)n.props.simulator.startRunning();else if("s"===t.key)n.props.simulator.stopRunning();else if("n"===t.key)n.props.simulator.advanceOne();else if("l"===t.key){var s=new m.d({kind:"and",x:i.x,y:i.y,savedState:!1});n.props.simulator.add(s)}else if("i"===t.key){var r=new m.a({kind:"input",x:i.x,y:i.y,savedState:!1});n.props.simulator.add(r)}else if("t"===t.key){var o=new m.e({kind:"timer",x:i.x,y:i.y,tickStorage:new Array(10).fill(!1)});n.props.simulator.add(o)}else if("["===t.key&&n.state.selected)n.state.selected.twiddle(-1);else if("]"===t.key&&n.state.selected)n.state.selected.twiddle(1);else if("x"===t.key&&n.state.selected)n.props.simulator.remove(n.state.selected);else if("4"===t.key){var c,l=Object(a.a)(n.state.interactables);try{for(l.s();!(c=l.n()).done;){c.value.reload()}}catch(d){l.e(d)}finally{l.f()}}else if("$"===t.key){var u,h=Object(a.a)(n.state.interactables);try{for(h.s();!(u=h.n()).done;){u.value.putOnLift()}}catch(d){h.e(d)}finally{h.f()}}else"p"===t.key&&n.state.selected&&n.state.selected.paint();console.debug("App.handleKeyPress("+t.key+")")},n.state={interactables:t.simulator.interactables,links:t.simulator.getLinks(),selected:void 0,linkSource:void 0,windowInnerHeight:window.innerHeight,windowInnerWidth:window.innerWidth};var r,c=Object(a.a)(n.props.simulator.interactables);try{for(c.s();!(r=c.n()).done;){r.value.onMoved(n.handleInteractableMoved)}}catch(l){c.e(l)}finally{c.f()}return n.props.simulator.onInteractableAdded(n.handleInteractableAdded),n.props.simulator.onInteractableRemoved(n.handleInteractableRemoved),n.props.simulator.onInteractablesReset(n.handleInteractablesReset),n}return Object(r.a)(i,[{key:"componentDidMount",value:function(){if(!this.stage)throw new Error("stage was not set?");var t=this.stage.container();t.tabIndex=1,t.focus(),t.addEventListener("keypress",this.handleKeyPress),window.addEventListener("resize",this.handleResize)}},{key:"handleInteractableClicked",value:function(t){this.setState({selected:t.model})}},{key:"handleLinkStart",value:function(t){var e=t.model;this.setState({linkSource:e,linkTargetX:t.evt.x,linkTargetY:t.evt.y})}},{key:"handleMouseUpInStage",value:function(t){if(this.state.linkSource){var e,i=void 0,n=Object(a.a)(this.state.interactables);try{for(n.s();!(e=n.n()).done;){var s=e.value;if(s.x<=t.evt.x&&t.evt.x<s.x+64&&s.y<=t.evt.y&&t.evt.y<s.y+64){i=s;break}}}catch(r){n.e(r)}finally{n.f()}i&&i!==this.state.linkSource&&i.addInput(this.state.linkSource)&&this.setState({links:this.props.simulator.getLinks(),linkSource:void 0,createByDragPrototype:void 0})}else this.state.createByDragPrototype&&this.state.createByDragPrototype.y<this.maxSensibleDropY&&this.props.simulator.add(this.state.createByDragPrototype);this.setState({linkSource:void 0,createByDragPrototype:void 0})}},{key:"handleMouseUpInInteractable",value:function(){console.debug("App.handleMouseUpInInteractable")}},{key:"handleMouseMove",value:function(t){this.state.linkSource?this.setState({linkTargetX:t.evt.offsetX,linkTargetY:t.evt.offsetY}):this.state.createByDragPrototype&&(this.state.createByDragPrototype.setPosition(t.evt.offsetX,t.evt.offsetY),this.setState({createByDragPrototype:this.state.createByDragPrototype}))}},{key:"handleMouseDown",value:function(t){t.target instanceof O||!this.state.selected||this.setState({selected:void 0})}},{key:"handleNewInteractableDrag",value:function(t){this.setState({createByDragPrototype:t.prototype})}},{key:"handleMouseLeave",value:function(){this.setState({linkSource:void 0,createByDragPrototype:void 0})}},{key:"getViewModelForModel",value:function(t,e){if(t instanceof m.d)return Object(n.jsx)(S,{model:t,isSelected:t===this.state.selected,onMouseUp:this.handleMouseUpInInteractable.bind(this),onLinkStart:this.handleLinkStart.bind(this),onClick:this.handleInteractableClicked.bind(this)},e);if(t instanceof m.a)return Object(n.jsx)(_,{model:t,isSelected:t===this.state.selected,onMouseUp:this.handleMouseUpInInteractable.bind(this),onLinkStart:this.handleLinkStart.bind(this),onClick:this.handleInteractableClicked.bind(this)},e);if(t instanceof m.e)return Object(n.jsx)(w,{model:t,isSelected:t===this.state.selected,onMouseUp:this.handleMouseUpInInteractable.bind(this),onLinkStart:this.handleLinkStart.bind(this),onClick:this.handleInteractableClicked.bind(this)},e);throw new Error("unexpected model object type")}},{key:"render",value:function(){var t=this,e=[],i=.9*window.innerHeight,a=window.innerWidth-17,s=a<1437?2:1,r=72*s+8,o=function(t){return i-r+8+(t>=9&&s>1?72:0)},c=function(t){return 15+79*(t>=9&&s>1?t-9:t)};return this.maxSensibleDropY=o(0)-32,this.state.linkSource&&(e=Object(n.jsx)(p.Arrow,{x:this.state.linkSource.x+32,y:this.state.linkSource.y+32,points:[0,0,this.state.linkTargetX-(this.state.linkSource.x+32),this.state.linkTargetY-(this.state.linkSource.y+32)],fill:"lightgrey",stroke:"lightgrey",strokeWidth:4,pointerLength:10,pointerWidth:10})),Object(n.jsxs)(p.Stage,{width:a-4,height:i,ref:function(e){t.stage=e},onMouseUp:this.handleMouseUpInStage.bind(this),onMouseMove:this.handleMouseMove.bind(this),onMouseLeave:this.handleMouseLeave.bind(this),children:[Object(n.jsxs)(p.Layer,{children:[Object(n.jsx)(p.Rect,{id:"background",x:0,y:0,width:a,height:i-r,onMouseDown:this.handleMouseDown.bind(this),strokeWidth:0,fill:"GhostWhite"}),Object(n.jsx)(v,{simulator:this.props.simulator,right:a-20,top:5}),this.state.interactables.map((function(e,i){return t.getViewModelForModel(e,i.toString())})),this.state.createByDragPrototype?this.getViewModelForModel(this.state.createByDragPrototype,"dragproto"):[],e,this.state.links.map((function(t,e){return Object(n.jsx)(T,{source:t.source,target:t.target},e)}))]}),Object(n.jsxs)(p.Layer,{children:[Object(n.jsx)(p.Rect,{x:0,y:i-r,height:r,width:a,fill:"papayawhip"}),Object(n.jsx)(p.Line,{points:[0,i-r,a,i-r],stroke:"grey",strokeWidth:3}),Object(n.jsx)(L,{x:c(0),y:o(0),selected:this.state.selected,kind:"and",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(L,{x:c(1),y:o(1),selected:this.state.selected,kind:"or",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(L,{x:c(2),y:o(2),selected:this.state.selected,kind:"xor",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(L,{x:c(3),y:o(3),selected:this.state.selected,kind:"nand",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(L,{x:c(4),y:o(4),selected:this.state.selected,kind:"nor",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(L,{x:c(5),y:o(5),selected:this.state.selected,kind:"xnor",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(L,{x:c(6),y:o(6),selected:this.state.selected,kind:"input",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(L,{x:c(7),y:o(7),selected:this.state.selected,kind:"timer",onBeginDrag:this.handleNewInteractableDrag.bind(this)}),Object(n.jsx)(B,{x:c(8),y:o(8),simulator:this.props.simulator,selected:this.state.selected}),Object(n.jsx)(D,{x:c(9),y:o(9),model:this.props.simulator}),Object(n.jsx)(E,{x:c(10),y:o(10),model:this.props.simulator}),Object(n.jsx)(z,{x:c(11),y:o(11),simulator:this.props.simulator}),Object(n.jsx)(P,{x:c(12),y:o(12),selected:this.state.selected}),Object(n.jsx)(W,{x:c(13),y:o(13),simulator:this.props.simulator}),Object(n.jsx)(U,{x:c(14),y:o(14),simulator:this.props.simulator}),Object(n.jsx)(H,{x:c(15),y:o(15),simulator:this.props.simulator}),Object(n.jsx)(F,{x:c(16),y:o(16),simulator:this.props.simulator}),Object(n.jsx)(A,{x:c(17),y:o(17),simulator:this.props.simulator})]})]})}}]),i}(u.Component);var Y=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,101)).then((function(e){var i=e.getCLS,n=e.getFID,a=e.getFCP,s=e.getLCP,r=e.getTTFB;i(t),n(t),a(t),s(t),r(t)}))};console.debug("In index"),function(){var t=window.location.search,e=void 0;t&&(e=f.a.decompressQueryStringFragment(t)),function(t){for(var e=function(){var e=n[i];y.a.Image.fromURL("/ScrapMechanicLogicGateSimulator/"+e+"-black.png",(function(i){j[e]=i,7===Object.keys(j).length&&t()}))},i=0,n=["and","or","xor","nand","nor","xnor","paint"];i<n.length;i++)e()}((function(){Object(d.render)(Object(n.jsx)(N,{simulator:new f.a(e)}),document.getElementById("root"))}))}(),Y()},11:function(t,e,i){"use strict";i.d(e,"b",(function(){return d})),i.d(e,"c",(function(){return p})),i.d(e,"d",(function(){return v})),i.d(e,"a",(function(){return b})),i.d(e,"e",(function(){return k}));var n=i(18),a=i(16),s=i(14),r=i(9),o=i(8),c=i(20),l=i(6),u=i(7),h=i(25),d=function(){function t(e){Object(l.a)(this,t),this._x=void 0,this._y=void 0,this.events=void 0,this._inputs=void 0,this._prevState=void 0,this._currentState=void 0,this.events=new h.EventEmitter,this._prevState=!1,this._currentState=!1,this._inputs=[],this._x=e.x,this._y=e.y}return Object(u.a)(t,[{key:"getPosition",value:function(){return{x:this._x,y:this._y}}},{key:"setPosition",value:function(t,e){this._x=t,this._y=e,this._emitMoved(t,e)}},{key:"setCurrentState",value:function(t){this._currentState!==t&&(this._currentState=t,this._emitStateChanged())}},{key:"setPrevState",value:function(t){this._prevState!==t&&(this._prevState=t,this._emitStateChanged())}},{key:"export",value:function(){return{x:this._x,y:this._y,kind:"input"}}},{key:"addInput",value:function(t){if(0===this.inputLimit)return!1;var e=this.inputs.indexOf(t);if(e>=0)this._inputs.splice(e,1);else{var i=t.inputs.indexOf(this);i>=0&&(t._inputs.splice(i,1),t.calculate()),1===this.inputLimit&&(this._inputs=[]),this._inputs.push(t)}return this.calculate(),this.paint(),t.paint(),!0}},{key:"removeInput",value:function(t){var e=this.inputs.indexOf(t);return!(e<0)&&(this._inputs.splice(e,1),this.calculate(),this.paint(),!0)}},{key:"setInputs",value:function(t){this._inputs=Object(c.a)(t)}},{key:"twiddle",value:function(t){}},{key:"apply",value:function(){this.setPrevState(this.currentState)}},{key:"calculate",value:function(){}},{key:"reload",value:function(){}},{key:"putOnLift",value:function(){}},{key:"paint",value:function(){}},{key:"onMoved",value:function(t){this.events.on("moved",t)}},{key:"offMoved",value:function(t){this.events.off("moved",t)}},{key:"onStateChanged",value:function(t){this.events.on("stateChanged",t)}},{key:"offStateChanged",value:function(t){this.events.off("stateChanged",t)}},{key:"_emitMoved",value:function(t,e){this.events.emit("moved",{source:this,x:t,y:e})}},{key:"_emitStateChanged",value:function(){this.events.emit("stateChanged",{source:this})}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"currentState",get:function(){return this._currentState}},{key:"prevState",get:function(){return this._prevState}},{key:"inputs",get:function(){return Object(c.a)(this._inputs)}},{key:"inputLimit",get:function(){return"unlimited"}}],[{key:"deserialize",value:function(t){switch(t.kind){case"input":return new b(t);case"timer":return new k(t);default:return new v(t)}}}]),t}(),p=function(t){Object(r.a)(i,t);var e=Object(o.a)(i);function i(t){var n;return Object(l.a)(this,i),(n=e.call(this,t))._savedState=void 0,n._savedState=t.savedState,n}return Object(u.a)(i,[{key:"export",value:function(){return Object(n.a)(Object(n.a)({},Object(a.a)(Object(s.a)(i.prototype),"export",this).call(this)),{},{savedState:this._savedState})}},{key:"paint",value:function(){this._savedState!==this.currentState&&(this._savedState=this.currentState,Object(a.a)(Object(s.a)(i.prototype),"_emitStateChanged",this).call(this))}},{key:"reload",value:function(){this.setCurrentState(this.savedState),this.setPrevState(!1)}},{key:"savedState",get:function(){return this._savedState}}]),i}(d),f=["and","or","xor","nand","nor","xnor"],v=function(t){Object(r.a)(i,t);var e=Object(o.a)(i);function i(t){var n;if(Object(l.a)(this,i),(n=e.call(this,t))._kind=void 0,"timer"===t.kind||"input"===t.kind)throw new Error("Caller should prevent this");return n._kind=t.kind,n}return Object(u.a)(i,[{key:"twiddle",value:function(t){var e=f.indexOf(this._kind);(e+=t)<0?e+=f.length:e>=f.length&&(e-=f.length),this.kind=f[e],this.calculate(),this.paint()}},{key:"calculate",value:function(){var t,e=this.inputs.reduce((function(t,e){return t+(e.prevState?1:0)}),0);switch(this.kind){case"and":t=this.inputs.length>0&&e===this.inputs.length;break;case"or":t=this.inputs.length>0&&e>0;break;case"xor":t=e%2===1;break;case"nand":t=this.inputs.length>0&&e!==this.inputs.length;break;case"nor":t=this.inputs.length>0&&0===e;break;case"xnor":t=this.inputs.length>0&&e%2===0}this.setCurrentState(t)}},{key:"putOnLift",value:function(){this.setCurrentState(this.inputs.length>0&&("nand"===this.kind||"nor"===this.kind||"xnor"===this.kind)),this.setPrevState(!1),this.paint()}},{key:"export",value:function(){return Object(n.a)(Object(n.a)({},Object(a.a)(Object(s.a)(i.prototype),"export",this).call(this)),{},{kind:this._kind})}},{key:"kind",get:function(){return this._kind},set:function(t){this._kind=t,this._emitStateChanged(),this.paint()}},{key:"inputLimit",get:function(){return"unlimited"}}]),i}(p),b=function(t){Object(r.a)(i,t);var e=Object(o.a)(i);function i(){return Object(l.a)(this,i),e.apply(this,arguments)}return Object(u.a)(i,[{key:"twiddle",value:function(t){this.setCurrentState(!this.currentState)}},{key:"putOnLift",value:function(){this.setCurrentState(!1),this.setPrevState(!1),this.paint()}},{key:"inputLimit",get:function(){return 0}}]),i}(p),k=function(t){Object(r.a)(i,t);var e=Object(o.a)(i);function i(t){var n;return Object(l.a)(this,i),(n=e.call(this,t))._tickStorage=void 0,n._tickStorage=Object(c.a)(t.tickStorage),n}return Object(u.a)(i,[{key:"export",value:function(){return Object(n.a)(Object(n.a)({},Object(a.a)(Object(s.a)(i.prototype),"export",this).call(this)),{},{kind:"timer",tickStorage:this._tickStorage})}},{key:"calculate",value:function(){this.setCurrentState(this._tickStorage[this._tickStorage.length-1]),this._tickStorage[0]=this.inputs.length>0&&this.inputs[0].prevState}},{key:"apply",value:function(){this.setPrevState(this.currentState);for(var t=0;t<this._tickStorage.length-1;++t)this._tickStorage[this._tickStorage.length-1-t]=this._tickStorage[this._tickStorage.length-2-t];this.setCurrentState(this._tickStorage[this._tickStorage.length])}},{key:"tickStorage",get:function(){return Object(c.a)(this._tickStorage)}},{key:"inputLimit",get:function(){return 1}}]),i}(d)},33:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return l}));var n=i(13),a=i(6),s=i(7),r=i(25),o=i(34),c=i(11),l=function(){function e(t){Object(a.a)(this,e),this._nextTickTimeoutId=void 0,this._pauseInterval=void 0,this._events=void 0,this.currentTick=void 0,this.isRunning=void 0,this.interactables=void 0,this._events=new r.EventEmitter,this.currentTick=0,this.isRunning=!1,this._nextTickTimeoutId=void 0,this._pauseInterval=250,this.interactables=[],t&&this.load(t)}return Object(s.a)(e,[{key:"serialize",value:function(){var t=this,e=this.getLinks();return{interactables:this.interactables.map((function(t){return t.export()})),links:e.map((function(e){return{source:t.interactables.indexOf(e.source),target:t.interactables.indexOf(e.target)}}))}}},{key:"load",value:function(t){var e=this.interactables;this.interactables=t.interactables.map((function(t){return c.b.deserialize(t)}));for(var i=new Array(this.interactables.length),a=0;a<this.interactables.length;++a)i[a]=new Array;var s,r=Object(n.a)(t.links);try{for(r.s();!(s=r.n()).done;){var o=s.value;i[o.target].push(this.interactables[o.source])}}catch(u){r.e(u)}finally{r.f()}for(var l=0;l<this.interactables.length;++l)this.interactables[l].setInputs(i[l]);this._emitInteractablesReset({simulator:this,oldInteractables:e}),this.stopRunning()}},{key:"gameReload",value:function(){var t,e=Object(n.a)(this.interactables);try{for(e.s();!(t=e.n()).done;){t.value.reload()}}catch(i){e.e(i)}finally{e.f()}this.currentTick=0,this._emitTick()}},{key:"serializeToCompressedQueryStringFragment",value:function(){var e=JSON.stringify(this.serialize()),i=o.a.deflate(e),n=t.from(i).toString("base64");return encodeURIComponent(n)}},{key:"startRunning",value:function(){this.isRunning||(this.isRunning=!0,this._nextTickTimeoutId=setTimeout(this._handleTickTimeout.bind(this),this._pauseInterval),this._events.emit("runStateChanged",{simulator:this,newRunState:this.isRunning}))}},{key:"stopRunning",value:function(){this.isRunning&&(this.isRunning=!1,this._nextTickTimeoutId&&clearTimeout(this._nextTickTimeoutId),this._nextTickTimeoutId=void 0,this._events.emit("runStateChanged",{simulator:this,newRunState:this.isRunning}))}},{key:"advanceOne",value:function(){this.isRunning||this._advanceOne()}},{key:"add",value:function(t){this.interactables.push(t),this._events.emit(u.interactableAdded,{simulator:this,interactable:t})}},{key:"remove",value:function(t){for(var e=!1,i=this.interactables.length-1;i>=0;--i)this.interactables[i]===t&&(e=!0,this.interactables.splice(i,1));var a,s=Object(n.a)(this.interactables);try{for(s.s();!(a=s.n()).done;){a.value.removeInput(t)}}catch(r){s.e(r)}finally{s.f()}return e&&this._events.emit(u.interactableRemoved,{simulator:this,interactable:t}),e}},{key:"getLinks",value:function(){return this.interactables.map((function(t){return t.inputs.map((function(e){return{source:e,target:t}}))})).reduce((function(t,e){return t.concat(e)}),[])}},{key:"_advanceOne",value:function(){++this.currentTick,this._emitTick();var t,e=Object(n.a)(this.interactables);try{for(e.s();!(t=e.n()).done;){t.value.apply()}}catch(s){e.e(s)}finally{e.f()}var i,a=Object(n.a)(this.interactables);try{for(a.s();!(i=a.n()).done;){i.value.calculate()}}catch(s){a.e(s)}finally{a.f()}}},{key:"onTick",value:function(t){this._events.on(u.tick,t)}},{key:"offTick",value:function(t){this._events.off(u.tick,t)}},{key:"_emitTick",value:function(){this._events.emit(u.tick,{simulator:this,tick:this.currentTick})}},{key:"onInteractableAdded",value:function(t){this._events.on(u.interactableAdded,t)}},{key:"offInteractableAdded",value:function(t){this._events.off(u.interactableAdded,t)}},{key:"onInteractableRemoved",value:function(t){this._events.on(u.interactableRemoved,t)}},{key:"offInteractableRemoved",value:function(t){this._events.off(u.interactableRemoved,t)}},{key:"onRunStateChanged",value:function(t){this._events.on("runStateChanged",t)}},{key:"offRunStateChanged",value:function(t){this._events.off("runStateChanged",t)}},{key:"onInteractablesReset",value:function(t){this._events.on("interactablesReset",t)}},{key:"offInteractablesReset",value:function(t){this._events.off("interactablesReset",t)}},{key:"_emitInteractablesReset",value:function(t){this._events.emit("interactablesReset",t)}},{key:"_handleTickTimeout",value:function(){this._advanceOne(),this._nextTickTimeoutId=setTimeout(this._handleTickTimeout.bind(this),this._pauseInterval)}}],[{key:"decompressQueryStringFragment",value:function(e){var i=decodeURIComponent(e),n=t.from(i,"base64"),a=o.a.inflate(n,{to:"string"});return JSON.parse(a)}}]),e}(),u={tick:"tick",interactableAdded:"interactableAdded",interactableRemoved:"interactableRemoved"}}).call(this,i(96).Buffer)},47:function(t,e,i){}},[[100,1,2]]]);
//# sourceMappingURL=main.641abf58.chunk.js.map